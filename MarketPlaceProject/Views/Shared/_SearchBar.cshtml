@model IEnumerable<MarketPlaceProject.ViewModels.CategoryVM>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://code.jquery.com/ui/1.13.3/jquery-ui.js"></script>

<div class="search-container">
    <label for="categorySelect"></label>
    <select id="categorySelect" name="categorySelect">
        @foreach (var category in Model)
        {
            <option value="@category.CategoryID">@category.CategoryName</option>
        }
    </select>
    <input id="subs" name="SubCategories" placeholder="Search..." />
    <button id="searchButton">
        <img src="~/Content/icons/search.png" alt="Search" style="width: 20px; height: 20px; vertical-align: middle;" />
    </button>
</div>

<script>
    var availableSubs = [];
    var subCategoryMap = {};
    $(function () {
        $('#categorySelect').change(function () {
            availableSubs = [];
            var categoryID = $(this).val();
            $.ajax({
                url: '@Url.Action("GetCategory", "Product")',
                data: { categoryID: categoryID },
                success: function (data) {
                    $.each(data, function (index, subCategory) {
                        availableSubs.push(subCategory.name);
                        subCategoryMap[subCategory.name] = subCategory.id;
                    });
                    $("#subs").autocomplete({
                        source: availableSubs
                    });
                }
            });
        });
        $('#categorySelect').trigger('change');

        $('#searchButton').click(function () {
            var selectedSub = $("#subs").val();
            var selectedSubID = subCategoryMap[selectedSub];
            console.log(selectedSubID);
            if (selectedSubID) {
                window.location.href = '@Url.Action("SearchProducts", "Product")' + '?subcategoryID=' + encodeURIComponent(selectedSubID);
            }
        });

        $('#compareButton').click(function () {
            var selectedProducts = [];
            $('.product-checkbox:checked').each(function () {
                selectedProducts.push($(this).val());
            });
            if (selectedProducts.length > 0) {
                window.location.href = '@Url.Action("CompareProducts", "Product")' + '?productIDs=' + encodeURIComponent(selectedProducts.join(','));
            }
        });
    });
</script>